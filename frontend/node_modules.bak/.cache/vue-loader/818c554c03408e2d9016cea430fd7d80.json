{"remainingRequest":"/srv/repos/bodega_central/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/srv/repos/bodega_central/frontend/src/components/bodega/Salida.vue?vue&type=style&index=0&id=e5f54206&prod&scoped=true&lang=css&","dependencies":[{"path":"/srv/repos/bodega_central/frontend/src/components/bodega/Salida.vue","mtime":1724688758857},{"path":"/srv/repos/bodega_central/frontend/node_modules/css-loader/dist/cjs.js","mtime":1676473588380},{"path":"/srv/repos/bodega_central/frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1676473588036},{"path":"/srv/repos/bodega_central/frontend/node_modules/postcss-loader/src/index.js","mtime":1676473588672},{"path":"/srv/repos/bodega_central/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1676473588660},{"path":"/srv/repos/bodega_central/frontend/node_modules/vue-loader/lib/index.js","mtime":1676473588036}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5hcnQtc2VsZWNjaW9uYWRvIHsKICBjb2xvcjogIzE1NTcyNCAhaW1wb3J0YW50OwogIGJhY2tncm91bmQtY29sb3I6ICNkNGVkZGEgIWltcG9ydGFudDsKICBib3JkZXItY29sb3I6ICNjM2U2Y2IgIWltcG9ydGFudDsKfQoKLmFydC1zZWxlY2Npb25hZG8gdGR7CiAgY29sb3I6ICMxNTU3MjQgIWltcG9ydGFudDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDRlZGRhICFpbXBvcnRhbnQ7CiAgYm9yZGVyLWNvbG9yOiAjYzNlNmNiICFpbXBvcnRhbnQ7Cn0K"},{"version":3,"sources":["Salida.vue"],"names":[],"mappings":";AA4UA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Salida.vue","sourceRoot":"src/components/bodega","sourcesContent":["<template>\n  <div class=\"container-fluid\">\n    <loader-component :cargando_pagina=\"cargando_pagina\"/>\n    <div class=\"row\">\n      <div class=\"col-xl-8 col-lg-8 col-md-8 col-sm-12 text-md-left text-center\">\n        <h3><i class=\"fas fa-fw fa-truck mr-2\"></i>SALIDA DE BODEGA</h3>\n      </div>\n      <div class=\"col-xl-4 col-lg-4 col-md-4 col-sm-12 mt-sm-2 mt-md-0 text-md-right text-center\">\n        <b-button @click=\"modal_historial=true;\" variant=\"success\" size=\"sm\"><i class=\"fas fa-fw fa-history mr-2\"></i>HISTORIAL DE SALIDAS</b-button>\n      </div>\n    </div>\n\n    <!-- <div class=\"row justify-content-center mt-4\">\n      <div class=\"col-xl-6 col-md-10 col-12\">\n        Filtrar por bodega:\n        <b-form-select @change=\"listarOrdenesTraspaso();\" v-model=\"filtro_bodega\" class=\"mb-3\" :options=\"sucursales\" :value-field=\"'suc_id'\" :text-field=\"'suc_nombre'\">\n          <b-form-select-option value=\"''\">Todas</b-form-select-option>\n        </b-form-select>\n      </div>\n    </div>\n    <div class=\"row justify-content-center mt-4 px-3\">\n      <div class=\"col-xl-8 col-md-12 col-12 border p-0\">\n        <table class=\"table table-striped text-center table-scroll mb-0\">\n          <thead>\n            <tr>\n              <th scope=\"col\">INGRESO</th>\n              <th scope=\"col\">T.DOC</th>\n              <th scope=\"col\">DOC</th>\n              <th scope=\"col\">PESO</th>\n              <th scope=\"col\">DESP. ESTIMADO</th>\n              <th scope=\"col\" class=\"alert-dark\">ESTANTE</th>\n              <th scope=\"col\" class=\"alert-dark\">SECCION</th>\n              <th scope=\"col\" class=\"alert-dark\">NUMERO</th>\n              <th scope=\"col\" class=\"alert-dark\">-</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr v-for=\"(art, index) in articulos\" :key=\"'esp'+index\" :class=\"{'art-seleccionado': art.seleccionado}\">\n              <td class=\"p-1\">{{ \n                art.art_fecha_ingreso.split(' ')[0].split('-')[2]+'-'+\n                art.art_fecha_ingreso.split(' ')[0].split('-')[1]+'-'+\n                art.art_fecha_ingreso.split(' ')[0].split('-')[0]+' '+\n                art.art_fecha_ingreso.split(' ')[1].split(':')[0]+':'+\n                art.art_fecha_ingreso.split(' ')[1].split(':')[1]\n                }}</td>\n              <td class=\"p-1\">{{art.art_tipo_documento}}</td>\n              <td class=\"p-1\">{{art.art_documento}}</td>\n              <td class=\"p-1\">{{art.art_peso}}</td>\n              <td class=\"p-1\" :class=\"{'alert-danger':fechaPasada(art.art_despacho_estimado)}\">{{\n                art.art_despacho_estimado.split('-')[2]+'-'+\n                art.art_despacho_estimado.split('-')[1]+'-'+\n                art.art_despacho_estimado.split('-')[0]\n                }}</td>\n              <td class=\"p-1 alert-dark\">{{art.esp_estante}}</td>\n              <td class=\"p-1 alert-dark\">{{art.esp_seccion}}</td>\n              <td class=\"p-1 alert-dark\">{{art.esp_numero }}</td>\n              <td class=\"p-1 alert-dark\">\n                <b-form-checkbox :id=\"'checkbox-'+index\" v-model=\"art.seleccionado\" :name=\"'checkbox-'+index\" :value=\"true\" :unchecked-value=\"false\"></b-form-checkbox>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div> -->\n\n    <div class=\"row px-2\">\n      <div class=\"card w-100\">\n        <div class=\"card-header\">\n          <h5>Ordenes de traspaso</h5>\n          <div class=\"row justify-content-center mt-2\">\n            <div class=\"col-6 text-rigth\">\n              Filtrar por bodega:\n              <b-form-select @change=\"listarOrdenesTraspaso();\" v-model=\"filtro_bodega\" class=\"mb-3\" :options=\"sucursales\" :value-field=\"'suc_id'\" :text-field=\"'suc_nombre'\">\n                <b-form-select-option value=\"''\">Todas</b-form-select-option>\n              </b-form-select>\n            </div>\n          </div>\n        </div>\n        <div class=\"card-content\">\n          <b-table v-if=\"ordenes_traspaso.length > 0\" striped hover :items=\"ordenes_traspaso\" :fields=\"columnas_ordenes\" :thead-tr-class=\"'text-center align-middle bg-dark text-white'\">\n            <!-- <template v-slot:cell(art_cantidad)=\"data\">\n              <span>{{ data.value+' '+data.item.art_unidad_medida.toLowerCase()}}</span>\n            </template> -->\n            <template v-slot:cell(ing_rack)=\"data\">\n              <span>{{ data.item.esp_seccion+'-'+data.item.esp_estante+'-'+data.item.esp_numero }}</span>\n            </template>\n            <template v-slot:cell(opcion)=\"data\">\n              <b-button size=\"sm\" variant=\"primary\" @click=\"listarOrdenTraspaso(data.item.documento); orden_seleccionada=data.item; modal_ver_orden=true;\">VER</b-button>\n            </template>\n          </b-table>\n          <b-alert v-if=\"ordenes_traspaso.length == 0\" show variant=\"warning\" class=\"text-center m-3\">Sin datos para listar.</b-alert>\n        </div>\n      </div>\n    </div>\n\n    <b-modal title=\"Orden de traspaso\" v-model=\"modal_ver_orden\" size=\"xl\" hide-footer no-close-on-backdrop>\n      <div v-if=\"orden_seleccionada != '' && orden_seleccionada.detalle\">\n        <h6>Orden de traspaso: {{ orden_seleccionada.documento }}</h6>\n        <h6>Fecha: {{ orden_seleccionada.fecha }}</h6>\n        <h6>Bodega destino: {{ orden_seleccionada.bod+' - '+orden_seleccionada.nombod}}</h6>\n        <h6>Observacion: {{ orden_seleccionada.detalle.mensaje }}</h6>\n        <h6>Articulos:</h6>\n        <b-table v-if=\"!armando_salida\" striped hover :items=\"orden_seleccionada.detalle.codigos\" :fields=\"columnas_articulos_orden\" :thead-tr-class=\"'text-center align-middle bg-dark text-white'\">\n        </b-table>\n        <b-table v-else striped hover :items=\"orden_seleccionada.detalle.codigos\" :fields=\"columnas_articulos_orden2\" :thead-tr-class=\"'text-center align-middle bg-dark text-white'\">\n          <template v-slot:cell(cant_salida)=\"data\">\n            <b-form-input v-model=\"data.item.cant_salida\" size=\"sm\"></b-form-input>\n          </template>\n          <template v-slot:cell(estante)=\"data\">\n            <b-form-select v-model=\"data.item.articulo_seleccionado\" size=\"sm\">\n              <b-form-select-option v-for=\"estante in data.item.estantes\" v-key=\"estante.esp_id+'esp'\" v-text=\"'['+estante.esp_estante+'-'+estante.esp_seccion+'-'+estante.esp_numero+'] [ '+estante.articulo.ari_cantidad+' '+estante.articulo.ari_unidad_medida+', Bodega '+estante.articulo.ari_sucursal_destino+' ]'\" :value=\"estante.ari_id\"></b-form-select-option>\n            </b-form-select>\n          </template>\n        </b-table>\n        <h6 v-if=\"armando_salida\">Observacion</h6>\n        <b-form-textarea v-if=\"armando_salida\" v-model=\"orden_seleccionada.detalle.mensaje_nuevo\"></b-form-textarea>\n      </div>\n      <!-- {{ orden_seleccionada }} -->\n      <div class=\"mt-3 pt-3 border-top text-center\">\n        <b-button v-if=\"!armando_salida\" @click=\"armando_salida=true;\" variant=\"success\" size=\"sm\">Crear Salida de Bodega</b-button>\n        <b-button v-if=\"armando_salida\" @click=\"armando_salida=false;\" variant=\"danger\" size=\"sm\">Cancelar</b-button>\n        <b-button v-if=\"armando_salida\" :disabled=\"!validaDatos()\" @click=\"registrarSalida();\" variant=\"success\" size=\"sm\" class=\"ml-2\">Registrar Salida</b-button>\n      </div>\n    </b-modal>\n\n    <b-modal title=\"Historial de salidas\" v-model=\"modal_historial\" size=\"xl\" hide-footer no-close-on-backdrop @show=\"listarHistorialSalidas();\">\n      <div class=\"row\">\n        <div class=\"col-6\">\n          <h6>DESDE</h6>\n          <b-form-datepicker size=\"sm\" v-model=\"fecha_desde_historial\" class=\"mb-3\" placeholder=\"SELECCIONA FECHA\" label-help=\"Selecciona un día.\" label-no-date-selected=\"-\" label-next-month=\"SIGUIENTE MES\" label-prev-month=\"MES ANTERIOR\" label-prev-year=\"AÑO ANTERIOR\" label-next-year=\"SIGUIENTE AÑO\" label-current-month=\"MES ACTUAL\" start-weekday=\"1\"></b-form-datepicker>\n        </div>\n        <div class=\"col-6\">\n          <h6>HASTA</h6>\n          <b-form-datepicker size=\"sm\" v-model=\"fecha_hasta_historial\" class=\"mb-3\" placeholder=\"SELECCIONA FECHA\" label-help=\"Selecciona un día.\" label-no-date-selected=\"-\" label-next-month=\"SIGUIENTE MES\" label-prev-month=\"MES ANTERIOR\" label-prev-year=\"AÑO ANTERIOR\" label-next-year=\"SIGUIENTE AÑO\" label-current-month=\"MES ACTUAL\" start-weekday=\"1\"></b-form-datepicker>\n        </div>\n      </div>\n      <div>\n        <b-table striped hover :items=\"historial_salidas\" :fields=\"columnas_historial\" :thead-tr-class=\"'text-center align-middle bg-dark text-white'\">\n          <template v-slot:cell(sld_fecha_salida)=\"data\">\n            {{ data.value }}\n          </template>\n        </b-table>\n      </div>\n      <div class=\"mt-3 pt-3 border-top text-center\">\n        <b-button @click=\"modal_historial=false;\" variant=\"danger\" size=\"sm\">Cancelar</b-button>\n      </div>\n    </b-modal>\n\n  </div>\n</template>\n\n<script>\nexport default {\n  data(){\n    return{\n      cargando_pagina   : false,\n      sucursales        : [],\n      salida            : {sucursal:'', articulos:''},\n      articulos         : [],\n      tipos_documentos  : [\n        {value:33, text:'FACTURA'}, \n        {value:39, text:'BOLETA'}, \n        {value:52, text:'GUIA DESPACHO'}\n      ],\n\n      filtro_bodega     : '',\n      ordenes_traspaso  :[],\n      columnas_ordenes  : [\n        {key: 'documento' , label: 'Documento'      , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'fecha'     , label: 'Fecha'          , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'bod'       , label: 'Bodega'         , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'nombod'    , label: 'Nombre Bodega'  , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'opcion'    , label: 'Opcion'                           , tdClass:'p-1 text-center', thClass:'p-1'},\n      ],\n      columnas_articulos_orden: [\n        {key: 'codigo'  , label: 'SKU'        , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'nomart'  , label: 'Nombre'     , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'umed'    , label: 'U. Medida'  , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'cant'    , label: 'Cantidad'   , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n      ],\n      columnas_articulos_orden2: [\n        {key: 'codigo'        , label: 'SKU'                    , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'nomart'        , label: 'Nombre'                 , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'umed'          , label: 'U. Medida'              , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'cant'          , label: 'Cantidad Solicitada'    , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'cant_salida'   , label: 'Cantidad Salida'        , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'estante'       , label: 'Estante'                , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'}\n      ],\n      columnas_historial: [\n        {key: 'sld_id'                , label: 'ID Salida'        , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'sld_fecha_salida'      , label: 'Fecha'            , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'sld_bodega_destino'    , label: 'Bodega destino'   , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'sld_observacion'       , label: 'Observacion'      , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'sld_orden_traspaso'    , label: 'Orden traspaso'   , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'}\n      ],\n      orden_seleccionada    : '',\n      modal_ver_orden       : false,\n      armando_salida        : false,\n      modal_historial       : false,\n      fecha_desde_historial : '',\n      fecha_hasta_historial : '',\n      historial_salidas     : []\n    }\n  },\n  mounted(){\n    this.listarSucursales();\n    this.listarOrdenesTraspaso();\n    this.fecha_hasta_historial = new Date();\n    this.fecha_desde_historial = new Date(this.fecha_hasta_historial.getTime() - (60*(24*30)*60000));\n    this.fecha_desde_historial = this.fecha_desde_historial.getFullYear()+'-'+(this.fecha_desde_historial.getMonth()+1)+'-'+this.fecha_desde_historial.getDate();\n    this.fecha_hasta_historial = this.fecha_hasta_historial.getFullYear()+'-'+(this.fecha_hasta_historial.getMonth()+1)+'-'+this.fecha_hasta_historial.getDate();\n\n  },\n  methods:{\n    listarSucursales(){\n      this.cargando_pagina = true;\n      axios.post(base_url+'bodega/listarSucursales').then( resp => {\n        this.sucursales       = resp.data;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    listarProductosSucursal(){\n      this.cargando_pagina = true;\n      const datos = new URLSearchParams();\n      datos.append('id_sucursal', this.salida.sucursal);\n      axios.post(base_url+'bodega/listarProductosSucursal', datos).then( resp => {\n        this.articulos        = resp.data;\n        this.cargando_pagina  = false;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    listarOrdenesTraspaso(){\n      this.cargando_pagina = true;\n      const datos = new URLSearchParams();\n      datos.append('bodega', this.filtro_bodega);\n      axios.post(base_url+'bodega/listarOrdenesTraspaso', datos).then( resp => {\n        if(resp.data.status == 200){\n          this.ordenes_traspaso = resp.data.sotrasp;\n        }\n        else{\n          alert('Error al listar ordenes de traspaso.');\n        }\n        this.cargando_pagina  = false;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    listarOrdenTraspaso(id_orden){\n      this.cargando_pagina = true;\n      const datos = new URLSearchParams();\n      datos.append('id_orden', id_orden);\n      axios.post(base_url+'bodega/listarOrdenTraspaso', datos).then( resp => {\n        if(resp.data.status == 200){\n          this.orden_seleccionada.detalle = resp.data;\n        }\n        else{\n          alert('Error al listar ordenes de traspaso.');\n        }\n        this.cargando_pagina  = false;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    listarHistorialSalidas(id_orden){\n      this.cargando_pagina = true;\n      const datos = new URLSearchParams();\n      datos.append('fecha_desde', this.fecha_desde_historial);\n      datos.append('fecha_hasta', this.fecha_hasta_historial);\n      axios.post(base_url+'bodega/listarHistorialSalidas', datos).then( resp => {\n        this.historial_salidas = resp.data;  \n        this.cargando_pagina   = false;\n      }).catch(error =>{\n        console.log(error);\n        alert('Error al listar historial de salidas.');\n        this.cargando_pagina = false;\n      });\n    },\n\n    validaDatos(){\n      var resp = true;\n      this.orden_seleccionada.detalle.codigos.forEach(codigo => {\n        if(codigo.cant_salida <= 0 || codigo.cant_salida == '' || codigo.articulo_seleccionado == ''){\n          resp = false;\n        }\n      });\n      return resp;\n    },\n\n    registrarSalida(){\n      this.cargando_pagina = true;\n      const datos = new URLSearchParams();\n      datos.append('salida', JSON.stringify(this.orden_seleccionada));\n      axios.post(base_url+'bodega/registrarSalida', datos).then( resp => {\n        if(resp.data.key == 1){\n          alert('Salida registrada correctamente.');\n        }\n        else {\n          alert(resp.data.msj);\n        }\n        this.cargando_pagina   = false;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    fechaPasada(fecha){\n      const fecha_estimada = new Date(fecha);\n      const fecha_actual   = new Date();\n      if(fecha_estimada < fecha_actual){\n        return true;\n      }\n      else {\n        return false;\n      }\n    }\n  }\n}\n\n</script>\n\n<style scoped>\n.art-seleccionado {\n  color: #155724 !important;\n  background-color: #d4edda !important;\n  border-color: #c3e6cb !important;\n}\n\n.art-seleccionado td{\n  color: #155724 !important;\n  background-color: #d4edda !important;\n  border-color: #c3e6cb !important;\n}\n</style>\n"]}]}