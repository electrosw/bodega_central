{"remainingRequest":"/srv/repos/cables_ecom/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/srv/repos/cables_ecom/frontend/src/components/usuarios/Usuarios.vue?vue&type=script&lang=js&","dependencies":[{"path":"/srv/repos/cables_ecom/frontend/src/components/usuarios/Usuarios.vue","mtime":1676317566167},{"path":"/srv/repos/cables_ecom/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/srv/repos/cables_ecom/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCl7CiAgICByZXR1cm57CiAgICAgIGNvbHVtbmFzOiBbCiAgICAgICAgeyBrZXk6ICd1c3JfcnV0JyAgICAgICAgICAsIGxhYmVsOiAnUlVUJyAgICAgICAgICAsIHNvcnRhYmxlOiB0cnVlLCAgIHRkQ2xhc3M6J3AtMScsIHRoQ2xhc3M6J3AtMScgfSwKICAgICAgICB7IGtleTogJ3Vzcl9ub21icmVzJyAgICAgICwgbGFiZWw6ICdOT01CUkUnICAgICAgICwgc29ydGFibGU6IHRydWUsICAgdGRDbGFzczoncC0xJywgdGhDbGFzczoncC0xJyB9LAogICAgICAgIHsga2V5OiAndXNyX2FwZWxsaWRvX3AnICAgLCBsYWJlbDogJ0FQRUxMSURPIFAuJyAgLCBzb3J0YWJsZTogdHJ1ZSwgICB0ZENsYXNzOidwLTEnLCB0aENsYXNzOidwLTEnIH0sCiAgICAgICAgeyBrZXk6ICd1c3JfYXBlbGxpZG9fbScgICAsIGxhYmVsOiAnQVBFTExJRE8gTS4nICAsIHNvcnRhYmxlOiB0cnVlLCAgIHRkQ2xhc3M6J3AtMScsIHRoQ2xhc3M6J3AtMScgfQogICAgICBdLAogICAgICB1c3VhcmlvcyAgICAgICAgOiBbXSwKICAgICAgZmlsdHJvICAgICAgICAgIDogJycsCiAgICAgIG1vZGFsX251ZXZvICAgICA6IGZhbHNlLAogICAgICBjYXJnYW5kb19wYWdpbmEgOiBmYWxzZSwKICAgICAgbnVldm9fdXNyICAgICAgIDoge3J1dDonJywgbm9tYnJlczonJywgYXBlbGxpZG9fcDonJywgYXBlbGxpZG9fbTonJ30KICAgIH0KICB9LAogIG1vdW50ZWQoKXsKICAgIHRoaXMubGlzdGFyVXN1YXJpb3MoKTsKICB9LAogIG1ldGhvZHM6ewogICAgbGlzdGFyVXN1YXJpb3MoKXsKICAgICAgdGhpcy5jYXJnYW5kb19wYWdpbmEgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGJhc2VfdXJsKyd1c3Vhcmlvcy9saXN0YXJVc3VhcmlvcycpLnRoZW4oIHJlc3AgPT4gewogICAgICAgIHRoaXMudXN1YXJpb3MgICAgICAgICA9IHJlc3AuZGF0YS51c3VhcmlvczsKICAgICAgICB0aGlzLmNhcmdhbmRvX3BhZ2luYSAgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZXJyb3IgPT57CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIHRoaXMuY2FyZ2FuZG9fcGFnaW5hID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKCiAgICByZWdpc3RyYXJVc3VhcmlvKCl7CiAgICAgIHRoaXMuY2FyZ2FuZG9fcGFnaW5hID0gdHJ1ZTsKICAgICAgdmFyIHVzdWFyaW8gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMubnVldm9fdXNyKSk7CiAgICAgIHVzdWFyaW8uZHYgID0gdXN1YXJpby5ydXQuc3Vic3RyaW5nKHVzdWFyaW8ucnV0Lmxlbmd0aCAtIDEsIHVzdWFyaW8ucnV0Lmxlbmd0aCk7CiAgICAgIHVzdWFyaW8ucnV0ID0gdXN1YXJpby5ydXQucmVwbGFjZSgvWy58LV0vZywgJycpLnNsaWNlKDAsIC0xKTsKICAgICAgdmFyIGRhdGEgICAgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7CiAgICAgIGRhdGEuYXBwZW5kKCd1c3VhcmlvJywgSlNPTi5zdHJpbmdpZnkodXN1YXJpbykpOwogICAgICBheGlvcy5wb3N0KGJhc2VfdXJsKyd1c3Vhcmlvcy9yZWdpc3RyYXJVc3VhcmlvJywgZGF0YSkudGhlbiggcmVzcCA9PiB7CiAgICAgICAgdGhpcy5jYXJnYW5kb19wYWdpbmEgID0gZmFsc2U7CiAgICAgICAgaWYocmVzcC5kYXRhLmtleSA9PSAxKXsKICAgICAgICAgIHRoaXMubW9kYWxfbnVldm8gPSBmYWxzZTsKICAgICAgICAgIHRoaXMubnVldm9fdXNyLnJ1dCA9IHRoaXMubnVldm9fdXNyLm5vbWJyZXMgPSB0aGlzLm51ZXZvX3Vzci5hcGVsbGlkb19wID0gdGhpcy5udWV2b191c3IuYXBlbGxpZG9fbSA9ICcnOwogICAgICAgICAgdGhpcy5saXN0YXJVc3VhcmlvcygpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIGFsZXJ0KCdFUlJPUiBBTCBSRUdJU1RSQVIgVVNVQVJJTy4nKQogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZXJyb3IgPT57CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIHRoaXMuY2FyZ2FuZG9fcGFnaW5hID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKCiAgICBmb3JtYXRlYVJ1dChydXQpewogICAgICBjb25zdCBuZXdSdXQgPSBydXQucmVwbGFjZSgvXC4vZywnJykucmVwbGFjZSgvW15rfEt8XGRdL2csICcnKS5yZXBsYWNlKC9cLS9nLCAnJykudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgIGNvbnN0IGxhc3REaWdpdCA9IG5ld1J1dC5zdWJzdHIoLTEsIDEpOwogICAgICBjb25zdCBydXREaWdpdCA9IG5ld1J1dC5zdWJzdHIoMCwgbmV3UnV0Lmxlbmd0aC0xKQogICAgICBsZXQgZm9ybWF0ID0gJyc7CiAgICAgIHZhciBpID0gMDsKICAgICAgdmFyIGogPSAxOwogICAgICBmb3IgKGkgPSBydXREaWdpdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIGNvbnN0IGUgPSBydXREaWdpdC5jaGFyQXQoaSk7CiAgICAgICAgZm9ybWF0ID0gZS5jb25jYXQoZm9ybWF0KTsKICAgICAgICBpZiAoaiAlIDMgPT0gMCAmJiBqIDw9IHJ1dERpZ2l0Lmxlbmd0aCAtIDEpIHsKICAgICAgICAgIGZvcm1hdCA9ICcuJy5jb25jYXQoZm9ybWF0KTsKICAgICAgICB9CiAgICAgICAgaisrOwogICAgICB9CiAgICAgIHZhciBmb3JtYXRlYWRvID0gIiI7CiAgICAgIGlmKGZvcm1hdC5sZW5ndGggPiAwKXsKICAgICAgICBmb3JtYXRlYWRvID0gZm9ybWF0LmNvbmNhdCgnLScpLmNvbmNhdChsYXN0RGlnaXQpOwogICAgICB9CiAgICAgIGVsc2V7CiAgICAgICAgZm9ybWF0ZWFkbyA9IGxhc3REaWdpdDsKICAgICAgfQogICAgICByZXR1cm4gZm9ybWF0ZWFkbzsKICAgICAgLy9yZXR1cm4gZm9ybWF0LmNvbmNhdCgnLScpLmNvbmNhdChsYXN0RGlnaXQpOwogICAgfSwKCiAgICB2ZXJpZmljYVJ1dChydXQpewogICAgICBsZXQgcmVzcD1mYWxzZTsKICAgICAgaWYocnV0ICE9IG51bGwgJiYgcnV0LnRvU3RyaW5nKCkubGVuZ3RoID49IDExKXsKICAgICAgICBsZXQgZHYgPSBydXQuc3Vic3RyaW5nKHJ1dC5sZW5ndGggLSAxLCBydXQubGVuZ3RoKTsKICAgICAgICBydXQgPSBydXQucmVwbGFjZSgvWy58LV0vZywgJycpLnNsaWNlKDAsIC0xKTsKICAgICAgICBpZihydXQuaW5kZXhPZignSycpID09IC0xKXsKICAgICAgICAvL0RFU0NPTUVOVEFSIEVMIElGIFkgTEEgTExBVkUgUEFSQSBWQUxJREFSIENPTlRSQSBSVVQgJ0VTUEVDSUFMRVMnCiAgICAgICAgLy9pZighcnV0Lm1hdGNoKC8oS0t8MDAwMDAwMHwxMTExMTExfDIyMjIyMjJ8MzMzMzMzM3w0NDQ0NDQ0fDU1NTU1NTV8NjY2NjY2Nnw3Nzc3Nzc3fDg4ODg4ODh8OTk5OTk5OSkvZykpewogICAgICAgICAgICBsZXQgbT0wLHM9MTsKICAgICAgICAgICAgZm9yKDtydXQ7cnV0PU1hdGguZmxvb3IocnV0LzEwKSkKICAgICAgICAgICAgICBzPShzK3J1dCUxMCooOS1tKyslNikpJTExOwogICAgICAgICAgICBsZXQgZHZfY2FsYz0gKHM/cy0xOidLJykudG9TdHJpbmcoKTsKICAgICAgICAgICAgaWYoZHZfY2FsYz09PWR2KSByZXNwPXRydWU7CiAgICAgICAgLy8gfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzcDsKICAgIH0sCiAgfQp9Cgo="},{"version":3,"sources":["Usuarios.vue"],"names":[],"mappings":";AAyEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Usuarios.vue","sourceRoot":"src/components/usuarios","sourcesContent":["<template>\n  <div class=\"container-fluid\">\n    <loader-component :cargando_pagina=\"cargando_pagina\"/>\n    <div class=\"row\">\n      <div class=\"col-12 text-md-left text-center\">\n        <h3><i class=\"fas fa-fw fa-users mr-2\"></i>USUARIOS</h3>\n      </div>\n    </div>\n\n\n    <div class=\"row justify-content-center mt-4\">\n      <div class=\"col-12\">\n        <b-card no-body class=\"p-0\">\n          <template #header>\n            <div class=\"row\">\n              <div class=\"col-6 text-md-left text-center\">\n                <b-button @click=\"modal_nuevo = true;\" variant=\"success\" block><i class=\"fas fa-fw fa-user mr-2\"></i>NUEVO USUARIO</b-button>\n              </div>\n              <div class=\"col-6 text-md-left text-center\">\n                <b-input-group prepend=\"FILTRO\">\n                  <b-form-input v-model=\"filtro\" placeholder=\"BUSCAR\"></b-form-input>\n                </b-input-group>\n              </div>\n            </div>\n          </template>\n          <b-table show-empty class=\"mb-0\" :tbody-class=\"'text-center'\" :thead-tr-class=\"'text-center align-middle'\" :thead-class=\"'text-center align-middle'\" \n          :head-variant=\"'light'\" @filtered=\"onFiltered\" :items=\"usuarios\" :fields=\"columnas\" \n          :filter=\"filtro\" bordered hover responsive empty-text=\"SIN DATOS PARA LISTAR.\" empty-filtered-text=\"SIN DATOS PARA LISTAR.\">\n            <template v-slot:table-busy>\n              <div class=\"text-center text-dark my-2\">\n                <b-spinner class=\"align-middle\"></b-spinner>\n                <strong>&nbsp;CARGANDO...</strong>\n              </div>\n            </template>\n            <template v-slot:cell(usr_rut)=\"data\">\n              {{  formateaRut(data.value+'-'+data.item.usr_dv) }}\n            </template>\n            <template v-slot:cell(opciones)=\"data\">\n              <b-button variant=\"info\"><i class=\"fas fa-fw fa-eye\"></i> </b-button>\n            </template>\n          </b-table>\n        </b-card>\n      </div>\n    </div>\n\n    <b-modal v-model=\"modal_nuevo\" size=\"lg\" title=\"NUEVO USUARIO\" hide-footer no-close-on-backdrop :scrollable=\"false\">\n      RUT\n      <!-- <b-form-input v-model=\"nuevo_usr.rut\" class=\"mb-3\"></b-form-input> -->\n      <input maxlength=\"12\" v-model=\"nuevo_usr.rut\" type=\"text\" class=\"form-control mb-3\" @input=\"nuevo_usr.rut = formateaRut(nuevo_usr.rut)\" \n      :class=\"{'is-valid': verificaRut(nuevo_usr.rut), 'is-invalid': !verificaRut(nuevo_usr.rut) && nuevo_usr.rut != ''}\">\n      NOMBRES\n      <b-form-input v-model=\"nuevo_usr.nombres\" class=\"mb-3\"></b-form-input>\n      APELLIDO PATERNO\n      <b-form-input v-model=\"nuevo_usr.apellido_p\" class=\"mb-3\"></b-form-input>\n      APELLIDO MATERNO\n      <b-form-input v-model=\"nuevo_usr.apellido_m\" class=\"mb-3\"></b-form-input>\n\n      <div class=\"row mt-4 pt-3 border-top\">\n        <div class=\"col text-center\">\n          <b-button :disabled=\"\n            !verificaRut(nuevo_usr.rut) || \n            nuevo_usr.nombres     == '' || \n            nuevo_usr.apellido_p  == '' || \n            nuevo_usr.apellido_p  == ''\" @click=\"registrarUsuario();\" variant=\"primary\">REGISTRAR</b-button>\n        </div>\n      </div>\n\n    </b-modal>\n\n  </div>\n</template>\n\n<script>\nexport default {\n  data(){\n    return{\n      columnas: [\n        { key: 'usr_rut'          , label: 'RUT'          , sortable: true,   tdClass:'p-1', thClass:'p-1' },\n        { key: 'usr_nombres'      , label: 'NOMBRE'       , sortable: true,   tdClass:'p-1', thClass:'p-1' },\n        { key: 'usr_apellido_p'   , label: 'APELLIDO P.'  , sortable: true,   tdClass:'p-1', thClass:'p-1' },\n        { key: 'usr_apellido_m'   , label: 'APELLIDO M.'  , sortable: true,   tdClass:'p-1', thClass:'p-1' }\n      ],\n      usuarios        : [],\n      filtro          : '',\n      modal_nuevo     : false,\n      cargando_pagina : false,\n      nuevo_usr       : {rut:'', nombres:'', apellido_p:'', apellido_m:''}\n    }\n  },\n  mounted(){\n    this.listarUsuarios();\n  },\n  methods:{\n    listarUsuarios(){\n      this.cargando_pagina = true;\n      axios.post(base_url+'usuarios/listarUsuarios').then( resp => {\n        this.usuarios         = resp.data.usuarios;\n        this.cargando_pagina  = false;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    registrarUsuario(){\n      this.cargando_pagina = true;\n      var usuario = JSON.parse(JSON.stringify(this.nuevo_usr));\n      usuario.dv  = usuario.rut.substring(usuario.rut.length - 1, usuario.rut.length);\n      usuario.rut = usuario.rut.replace(/[.|-]/g, '').slice(0, -1);\n      var data    = new URLSearchParams();\n      data.append('usuario', JSON.stringify(usuario));\n      axios.post(base_url+'usuarios/registrarUsuario', data).then( resp => {\n        this.cargando_pagina  = false;\n        if(resp.data.key == 1){\n          this.modal_nuevo = false;\n          this.nuevo_usr.rut = this.nuevo_usr.nombres = this.nuevo_usr.apellido_p = this.nuevo_usr.apellido_m = '';\n          this.listarUsuarios();\n        }\n        else {\n          alert('ERROR AL REGISTRAR USUARIO.')\n        }\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    formateaRut(rut){\n      const newRut = rut.replace(/\\./g,'').replace(/[^k|K|\\d]/g, '').replace(/\\-/g, '').trim().toUpperCase();\n      const lastDigit = newRut.substr(-1, 1);\n      const rutDigit = newRut.substr(0, newRut.length-1)\n      let format = '';\n      var i = 0;\n      var j = 1;\n      for (i = rutDigit.length - 1; i >= 0; i--) {\n        const e = rutDigit.charAt(i);\n        format = e.concat(format);\n        if (j % 3 == 0 && j <= rutDigit.length - 1) {\n          format = '.'.concat(format);\n        }\n        j++;\n      }\n      var formateado = \"\";\n      if(format.length > 0){\n        formateado = format.concat('-').concat(lastDigit);\n      }\n      else{\n        formateado = lastDigit;\n      }\n      return formateado;\n      //return format.concat('-').concat(lastDigit);\n    },\n\n    verificaRut(rut){\n      let resp=false;\n      if(rut != null && rut.toString().length >= 11){\n        let dv = rut.substring(rut.length - 1, rut.length);\n        rut = rut.replace(/[.|-]/g, '').slice(0, -1);\n        if(rut.indexOf('K') == -1){\n        //DESCOMENTAR EL IF Y LA LLAVE PARA VALIDAR CONTRA RUT 'ESPECIALES'\n        //if(!rut.match(/(KK|0000000|1111111|2222222|3333333|4444444|5555555|6666666|7777777|8888888|9999999)/g)){\n            let m=0,s=1;\n            for(;rut;rut=Math.floor(rut/10))\n              s=(s+rut%10*(9-m++%6))%11;\n            let dv_calc= (s?s-1:'K').toString();\n            if(dv_calc===dv) resp=true;\n        // }\n        }\n      }\n      return resp;\n    },\n  }\n}\n\n</script>\n\n<style scoped>\n\n</style>\n"]}]}