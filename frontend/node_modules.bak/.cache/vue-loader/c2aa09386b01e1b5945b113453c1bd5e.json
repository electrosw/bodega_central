{"remainingRequest":"/srv/repos/bodega_central/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/srv/repos/bodega_central/frontend/src/components/bodega/Ingreso_nuevo.vue?vue&type=style&index=0&id=32f90adb&prod&lang=css&","dependencies":[{"path":"/srv/repos/bodega_central/frontend/src/components/bodega/Ingreso_nuevo.vue","mtime":1720729404509},{"path":"/srv/repos/bodega_central/frontend/node_modules/css-loader/dist/cjs.js","mtime":1676473588380},{"path":"/srv/repos/bodega_central/frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1676473588036},{"path":"/srv/repos/bodega_central/frontend/node_modules/postcss-loader/src/index.js","mtime":1676473588672},{"path":"/srv/repos/bodega_central/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1676473588660},{"path":"/srv/repos/bodega_central/frontend/node_modules/vue-loader/lib/index.js","mtime":1676473588036}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5lc3BhY2lvIHsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KCi5lc3BhY2lvOmhvdmVyIHsKICBjb2xvcjogIzE1NTcyNDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDRlZGRhOwogIGJvcmRlci1jb2xvcjogI2MzZTZjYjsKfQoKLmVzcGFjaW86YWN0aXZlewogIGJhY2tncm91bmQtY29sb3I6ICMyMGM5OTc7Cn0KCi8qIC50YWJsZS1zY3JvbGwgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBoZWlnaHQ6IDQwMHB4OwogIG92ZXJmbG93OiBhdXRvOwp9ICovCgouZGl2LXNjcm9sbCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIG92ZXJmbG93OiBhdXRvOwogIG1heC1oZWlnaHQ6IDQwMHB4Owp9CgoudnNfX2Ryb3Bkb3duLXRvZ2dsZSB7CiAgcGFkZGluZzogMCAwIDFweCFpbXBvcnRhbnQ7Cn0K"},{"version":3,"sources":["Ingreso_nuevo.vue"],"names":[],"mappings":";AA4XA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Ingreso_nuevo.vue","sourceRoot":"src/components/bodega","sourcesContent":["<template>\n  <div class=\"container-fluid\">\n    <loader-component :cargando_pagina=\"cargando_pagina\"/>\n    <div class=\"row\">\n      <div class=\"col-12 text-md-left text-center\">\n        <h3><i class=\"fas fa-fw fa-box mr-2\"></i>INGRESO BODEGA</h3>\n      </div>\n    </div>\n\n\n    <div v-if=\"nuevo_ingreso.oc == ''\" class=\"row justify-content-center mt-4\">\n      <div class=\"col-xl-6 col-md-10 col-12\">\n        N° ORDEN DE COMPRA\n        <b-form-input v-model=\"buscar_oc\" class=\"mb-3\"></b-form-input>\n      </div>\n      <div class=\"col-12 text-center\">\n        <b-button :disabled=\"buscar_oc == ''\" @click=\"listarOrdenCompra();\" variant=\"primary\" size=\"sm\">ACEPTAR</b-button>\n      </div>\n    </div>\n\n    <div v-else class=\"row justify-content-center mt-4\">\n      <div class=\"col-12\">\n        <b-card>\n          <table>\n            <td>\n              <tr><strong class=\"pr-3\">Orden de compra</strong></tr>\n              <tr><strong class=\"pr-3\">Fecha</strong></tr>\n              <tr><strong class=\"pr-3\">Bodega</strong></tr>\n              <tr><strong class=\"pr-3\">Glosa</strong></tr>\n            </td>\n            <td>\n              <tr>:<span class=\"pl-3\">{{ nuevo_ingreso.oc}}</span></tr>\n              <tr>:<span class=\"pl-3\">{{ nuevo_ingreso.fecha}}</span></tr>\n              <tr>:<span class=\"pl-3\">{{ nuevo_ingreso.bodega}}</span></tr>\n              <tr>:<span class=\"pl-3\">{{ nuevo_ingreso.glosa}}</span></tr>\n            </td>\n          </table>\n          <h6 v-if=\"nuevo_ingreso.mensaje != ''\"><strong>Mensaje:</strong> {{ nuevo_ingreso.mensaje }}</h6>\n\n          <b-table striped hover :items=\"nuevo_ingreso.articulos\" :fields=\"columnas_articulos\" :thead-tr-class=\"'text-center align-middle bg-dark text-white'\">\n            <template v-slot:cell(saldo)=\"data\">\n              <span :class=\"{'badge badge-success badge-pill':data.value<=0, 'badge badge-warning badge-pill':data.value>0}\">{{ data.value }}</span>\n            </template>\n            <template v-slot:cell(cant_recibida)=\"data\">\n              <b-form-input size=\"sm\" type=\"text\" v-model=\"data.item.cant_recibida\" :class=\"{'is-valid':validaNumero(data.item.cant_recibida) && data.item.cant_recibida != 0, 'is-invalid':!validaNumero(data.item.cant_recibida) && data.item.cant_recibida != 0}\"></b-form-input>\n            </template>\n            <template v-slot:cell(estantes_usar)=\"data\">\n              <b-form-input size=\"sm\" type=\"text\" v-model=\"data.item.estantes_usar\" @change=\"data.item.estantes = cambioEstantes(data.item.estantes, data.item.estantes_usar);\" :disabled=\"!validaNumero(data.item.cant_recibida) || data.item.cant_recibida == 0\" :class=\"{'is-valid':validaNumero(data.item.estantes_usar) && data.item.estantes_usar !=0 && data.item.cant_recibida != 0, 'is-invalid':(!validaNumero(data.item.estantes_usar) || data.item.estantes_usar == 0) && data.item.cant_recibida != 0}\"></b-form-input>\n            </template>\n            <template v-slot:cell(estantes)=\"data\">\n              <!-- <b-form-select size=\"sm\" v-model=\"data.item.estante\" :disabled=\"!validaNumero(data.item.cant_recibida) || data.item.cant_recibida == 0\" :class=\"{'is-invalid': data.item.estante == 0 && validaNumero(data.item.cant_recibida) && data.item.cant_recibida != 0, 'is-valid': data.item.estante != 0 && validaNumero(data.item.cant_recibida)}\">\n                <b-form-select-option v-for=\"espacio in espacios_disponibles\" :key=\"espacio.esp_id\" :value=\"espacio.esp_id\">\n                  {{ espacio.esp_estante+'-'+espacio.esp_seccion+'-'+espacio.esp_numero+' ('+espacio.esp_peso+'kg)' }}\n                </b-form-select-option>\n              </b-form-select> -->\n              <div style=\"width: 300px!important;\" class=\"container-fluid\">\n                <div class=\"row p-0\" v-for=\"(estante,index) in data.item.estantes\" :key=\"'idx'+index\">\n                  <div class=\"col-4 p-0\">\n                    <b-form-input size=\"sm\" type=\"text\" v-model=\"estante.cantidad\" :disabled=\"!validaNumero(data.item.cant_recibida) || data.item.cant_recibida == 0\" :class=\"{'is-valid':validaNumero(estante.cantidad) && estante.cantidad != 0 && data.item.cant_recibida !=0, 'is-invalid':(!validaNumero(estante.cantidad) || estante.cantidad == 0 || !validaCantidadRecibida(data.item)) && data.item.cant_recibida != 0}\"></b-form-input>\n                  </div>\n                  <div class=\"col-8 p-0\">\n                    <v-select style=\"width: 100%!important;\" class=\"form-control form-control-sm p-0 h-auto\" :reduce=\"(espacio) => espacio.esp_id\" label=\"esp_nombre\" v-model=\"estante.estante\" :clearable=\"true\" :closeOnSelect=\"true\" :options=\"espacios_disponibles\" :disabled=\"!validaNumero(data.item.cant_recibida) || data.item.cant_recibida == 0\" :class=\"{'is-invalid': estante.estante == 0 && validaNumero(data.item.cant_recibida) && data.item.cant_recibida != 0, 'is-valid': estante.estante != 0 && validaNumero(data.item.cant_recibida) && data.item.cant_recibida != 0}\">\n                      <template v-slot:no-options=\"{ search, searching }\">\n                        <template v-if=\"searching\">\n                          SIN RESULTADOS PARA <em>{{ search }}</em>.\n                        </template>\n                        <em style=\"opacity: 0.5;\" v-else>SIN OPCIONES PARA MOSTRAR.</em>\n                      </template>\n                    </v-select>\n                  </div>\n                </div>\n              </div>\n            </template>\n          </b-table>\n          \n          <div class=\"row text-center\">\n            <div class=\"col\"><b-button size=\"sm\" @click=\"limpiarIngreso();\" variant=\"danger\">CANCELAR</b-button></div>\n            <div class=\"col\"><b-button size=\"sm\" :disabled=\"!validarIngreso()\" @click=\"modal_confirmar_oc=true;\" variant=\"success\">ACEPTAR</b-button></div>\n          </div>\n        </b-card>\n      </div>\n    </div>\n\n    <b-modal v-model=\"modal_confirmar_oc\" size=\"lg\" title=\"CONFIRMAR\" hide-footer no-close-on-backdrop>\n      <div v-if=\"ingresando_datos_extra\" class=\"w-100\">\n        <h6>Selecciona sucursal de destino:</h6>\n        <b-form-select v-model=\"nuevo_ingreso.bodega_despacho\" class=\"mb-3\" :options=\"sucursales\" :value-field=\"'suc_id'\" :text-field=\"'suc_nombre'\"></b-form-select>\n        <h6>Fecha estimada de despacho:</h6>\n        <b-form-datepicker v-model=\"nuevo_ingreso.fecha_despacho\" class=\"mb-3\" :min=\"fecha_actual\" placeholder=\"SELECCIONA FECHA\" label-help=\"Selecciona un día.\" label-no-date-selected=\"-\" label-next-month=\"SIGUIENTE MES\" label-prev-month=\"MES ANTERIOR\" label-prev-year=\"AÑO ANTERIOR\" label-next-year=\"SIGUIENTE AÑO\" label-current-month=\"MES ACTUAL\" start-weekday=\"1\"></b-form-datepicker>\n\n        <h6>Tipo documento asociado(opcional):</h6>\n        <b-form-select v-model=\"nuevo_ingreso.tipo_doc_asociado\" class=\"mb-3\" :options=\"tipos_documentos\"></b-form-select>\n        <h6>Documento asociado(opcional):</h6>\n        <b-form-input v-model=\"nuevo_ingreso.doc_asociado\" class=\"mb-3\"></b-form-input>\n\n        <h6>Rut transportista:</h6>\n        <b-form-input v-model=\"nuevo_ingreso.doc_asociado\" class=\"mb-3\"></b-form-input>\n        <h6>Orden transporte:</h6>\n        <b-form-input v-model=\"nuevo_ingreso.doc_asociado\" class=\"mb-3\"></b-form-input>\n        <h6>Fecha transporte:</h6>\n        <b-form-input v-model=\"nuevo_ingreso.doc_asociado\" class=\"mb-3\"></b-form-input>\n        <h6>Peso transporte:</h6>\n        <b-form-input v-model=\"nuevo_ingreso.doc_asociado\" class=\"mb-3\"></b-form-input>\n\n        <h6>Observación:</h6>\n        <b-form-textarea placeholder=\"Ingresa texto...\" rows=\"3\" max-rows=\"6\"></b-form-textarea>\n        \n      </div>\n      <div v-else class=\"w-100\">\n        <div class=\"container-fluid mb-3 card p-3\">\n          <h6><strong>Confirma los siguente datos para el ingreso de bodega:</strong></h6>\n          <ul>\n            <li v-show=\"articulo.cant_recibida > 0\" v-for=\"articulo in nuevo_ingreso.articulos\" :key=\"articulo.codigo\">\n              <div class=\"row\">\n                <div class=\"col-2\">{{ articulo.codigo }}</div>\n                <div class=\"col-8 font-weight-bold\">{{ articulo.nomart }}</div>\n                <div class=\"col-2 text-right\">    \n                  <span class=\"badge badge-dark badge-pill\">\n                    <strong>{{ articulo.cant_recibida +' '+articulo.umed }}</strong>\n                  </span>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col\">\n                  <ul>\n                    <li v-for=\"(estante, index) in articulo.estantes\" :key=\"'est'+index\">{{ estante.cantidad+' '+articulo.umed }} en estante <span class=\"badge badge-primary badge-pill\" v-for=\"espacio in espacios_disponibles\" :key=\"'esp'+espacio.esp_id\" v-if=\"espacio.esp_id == estante.estante\">{{ espacio.esp_nombre }}</span></li>\n                  </ul>\n                </div>\n              </div>\n            </li>\n          </ul>\n        </div>\n        <div class=\"container-fluid card p-3\">\n          <div class=\"row\">\n            <div class=\"col-5\"><h6>Sucursal de destino</h6></div>\n            <div class=\"col-7\"><h6 v-for=\"(bodega,index) in sucursales\" :key=\"'suc'+index\" v-show=\"bodega.suc_id==nuevo_ingreso.bodega_despacho\">: {{bodega.suc_nombre}}</h6></div>\n            <div class=\"col-5\"><h6>Fecha estimada de despacho</h6></div>\n            <div class=\"col-7\"><h6>: {{ nuevo_ingreso.fecha_despacho.split('-')[2]+'-'+nuevo_ingreso.fecha_despacho.split('-')[1]+'-'+nuevo_ingreso.fecha_despacho.split('-')[0] }}</h6></div>\n            <div v-if=\"nuevo_ingreso.tipo_doc_asociado != ''\" class=\"col-5\"><h6>Tipo documento asociado</h6></div>\n            <div v-if=\"nuevo_ingreso.tipo_doc_asociado != ''\" class=\"col-7\"><h6 v-for=\"(doc,index) in tipos_documentos\" :key=\"'tip'+index\" v-show=\"doc.value==nuevo_ingreso.tipo_doc_asociado\">: {{doc.text}}</h6></div>\n            <div v-if=\"nuevo_ingreso.doc_asociado != ''\" class=\"col-5\"><h6>N° Documento asociado</h6></div>\n            <div v-if=\"nuevo_ingreso.doc_asociado != ''\" class=\"col-7\"><h6>: {{nuevo_ingreso.doc_asociado}}</h6></div>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"ingresando_datos_extra\" class=\"row mt-3 pt-3 border-top text-center\">\n        <div class=\"col\"><b-button @click=\"modal_confirmar_oc=false;ingresando_datos_extra=true;\" size=\"sm\" variant=\"danger\">CANCELAR</b-button></div>\n        <div class=\"col\"><b-button @click=\"ingresando_datos_extra=false;\" size=\"sm\" variant=\"success\">CONTINUAR</b-button></div>\n      </div>\n      <div v-else class=\"row mt-3 pt-3 border-top text-center\">\n        <div class=\"col\"><b-button @click=\"modal_confirmar_oc=false;ingresando_datos_extra=true;\" size=\"sm\" variant=\"danger\">CANCELAR</b-button></div>\n        <div class=\"col\"><b-button :disabled=\"nuevo_ingreso.bodega_despacho == '' || nuevo_ingreso.fecha_despacho == ''\" @click=\"registrarIngreso();\" size=\"sm\" variant=\"success\">CONFIRMAR</b-button></div>\n      </div>\n    </b-modal>\n\n\n    <b-modal v-model=\"modal_msj\" size=\"lg\" title=\"REGISTRO DE INGRESO\" hide-footer no-close-on-backdrop :scrollable=\"false\">\n      <div class=\"row\">\n        <div class=\"col-12\">\n          <h6><strong>{{msj_registro}}</strong></h6>\n        </div>\n      </div>\n      <div class=\"row mt-3 pt-3 border-top\">\n        <div class=\"col text-center\">\n          <b-button @click=\"limpiarDatos();\" variant=\"primary\" size=\"sm\">ACEPTAR</b-button>\n        </div>\n      </div>\n    </b-modal>\n\n  </div>\n</template>\n\n<script>\nexport default {\n  data(){\n    return{\n      cargando_pagina   : false,\n      //nuevo_ingreso     : {documento:'', tipo_documento:'', orden_compra:'1133762', sucursal:'', fecha_despacho:'', peso:'', espacio:''},\n      sucursales        : [],\n      tipos_documentos  : [\n        {value:33, text:'FACTURA'}, \n        {value:39, text:'BOLETA'}, \n        {value:52, text:'GUIA DESPACHO'}\n      ],\n      espacios_disponibles  : [],\n      esp_disp_filtrados    : [],\n      modal_msj             : false,\n      msj_registro          : '',\n      filtro_estante        : '',\n      fecha_actual          : '',\n\n      columnas_articulos    : [\n        {key: 'codigo'        , label: 'SKU'                , sortable: true  , tdClass:'p-1', thClass:'p-1'},\n        {key: 'nomart'        , label: 'Articulo'           , sortable: true  , tdClass:'p-1', thClass:'p-1'},\n        {key: 'umed'          , label: 'U. Medida'          , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'cant'          , label: 'Cantidad comprada'  , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'saldo'         , label: 'Saldo pendiente'    , sortable: true  , tdClass:'p-1 text-center', thClass:'p-1'},\n        {key: 'cant_recibida' , label: 'Cantidad recibida'  , sortable: true  , tdClass:'p-1', thClass:'p-1'},\n        {key: 'estantes_usar' , label: 'Estantes a usar'    , sortable: true  , tdClass:'p-1', thClass:'p-1'},\n        {key: 'estantes'      , label: 'Cantidad x Estante' , sortable: true  , tdClass:'p-1', thClass:'p-1'}\n      ],\n\n      nuevo_ingreso         : {bodega:'', fecha:'', glosa:'', mensaje:'', oc:'', articulos:[], fecha_estimada_despacho:'', bodega_despacho:'', doc_asociado:'', tipo_doc_asociado:''},\n      buscar_oc             : '1133762',\n      modal_confirmar_oc    : false,\n      ingresando_datos_extra: true,\n      formato_numero        : /^[0-9]+([.][0-9]*)?$/\n    }\n  },\n  mounted(){\n    this.fecha_actual = new Date();\n    this.listarSucursales();\n    this.listarEspaciosDisponibles();\n  },\n  methods:{\n    listarOrdenCompra(){\n      this.cargando_pagina = true;\n      const datos = new URLSearchParams();\n      datos.append('orden_compra', this.buscar_oc);\n      axios.post(base_url+'bodega/listarOrdenCompra', datos).then( resp => {\n        if(resp.data.status == 200){\n          if(resp.data.data.Cod == 200){\n            this.nuevo_ingreso.oc        = resp.data.data.ocompra;\n            this.nuevo_ingreso.bodega    = resp.data.data.bod;\n            this.nuevo_ingreso.fecha     = resp.data.data.fecha;\n            this.nuevo_ingreso.glosa     = resp.data.data.glosa;\n            this.nuevo_ingreso.mensaje   = resp.data.data.mensaje;\n            this.nuevo_ingreso.articulos = resp.data.data.codigos;\n          }\n          else{\n            alert('Orden de compra no encontrada.');\n          }\n        }\n        else {\n          alert('Falló la conexion con CGI interno.');\n        }\n        console.log(resp.data);\n        this.cargando_pagina      = false;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    limpiarIngreso(){\n      this.nuevo_ingreso = {bodega:'', fecha:'', glosa:'', mensaje:'', oc:'', articulos:[]};\n    },\n\n    validarIngreso(){\n      var flag = true;\n      this.nuevo_ingreso.articulos.forEach(articulo => {\n        if(!this.validaNumero(articulo.cant_recibida) || (this.validaNumero(articulo.cant_recibida) && articulo.cant_recibida != 0 && articulo.estante == 0)){\n          flag = false;\n        }\n      });\n      return flag;\n    },\n\n    validaCantidadRecibida(datos){\n      var suma = 0;\n      datos.estantes.forEach(estante => {\n        suma += parseFloat(estante.cantidad);\n      });\n      if(suma == parseFloat(datos.cant_recibida)){\n        return true;\n      }\n      else {\n        return false;\n      }\n    },\n\n    cambioEstantes(estantes, estantes_usar){\n      estantes = [];\n      if(estantes_usar > 0){\n        for(var i=0; i<estantes_usar; i++){\n          estantes.push({cantidad:0, estante:0});\n        }\n      }\n      else {\n        estantes.push({cantidad:0, estante:0});\n      }\n      return estantes;\n      /* if(estantes.length > estantes_usar){\n\n      }\n      else {\n\n      } */\n    },\n\n    validaNumero(cantidad){\n      if(!this.formato_numero.test(cantidad)){\n        return false;\n      }\n      else{\n        return true;\n      }\n    },\n\n    listarEspaciosDisponibles(){\n      this.cargando_pagina = true;\n      const datos = new URLSearchParams();\n      datos.append('peso', this.nuevo_ingreso.peso);\n      axios.post(base_url+'bodega/listarEspaciosDisponibles', datos).then( resp => {\n        this.espacios_disponibles = resp.data;\n        this.filtrarEstantes();\n        this.cargando_pagina      = false;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    filtrarEstantes(){\n      if(this.filtro_estante != ''){\n        this.esp_disp_filtrados = [];\n        this.espacios_disponibles.forEach(espacio => {\n          if(espacio.esp_estante == this.filtro_estante){\n            this.esp_disp_filtrados.push(espacio);\n          }\n        });\n      }\n      else {\n        this.esp_disp_filtrados = JSON.parse(JSON.stringify(this.espacios_disponibles))\n      }\n    },\n\n    listarSucursales(){\n      this.cargando_pagina = true;\n      axios.post(base_url+'bodega/listarSucursales').then( resp => {\n        this.sucursales       = resp.data;\n        this.cargando_pagina  = false;\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    /* validaDatos(){\n      if(this.nuevo_ingreso.documento != '' && this.nuevo_ingreso.tipo_documento != '' && this.nuevo_ingreso.sucursal != '' && this.nuevo_ingreso.fecha_despacho != '' && this.nuevo_ingreso.peso != ''){\n        return true;\n      }\n      else {\n        return false;\n      }\n    }, */\n\n    registrarIngreso(){\n      this.cargando_pagina = true;\n      const datos = new URLSearchParams();\n      datos.append('ingreso', JSON.stringify(this.nuevo_ingreso));\n      axios.post(base_url+'bodega/registrarIngreso', datos).then( resp => {\n        console.log(resp.data);\n        if(resp.data.key == 1){\n          alert('Ingreso registrado correctamente.');\n        }\n        else {\n          alert(esp.data.msj);\n        }\n        this.cargando_pagina   = false;\n\n      }).catch(error =>{\n        console.log(error);\n        this.cargando_pagina = false;\n      });\n    },\n\n    limpiarDatos(){\n      this.nuevo_ingreso = {documento:'', tipo_documento:'', orden_compra:'', sucursal:'', fecha_despacho:'', peso:'', espacio:''};\n      this.espacios_disponibles = [];\n      this.modal_msj = false;\n    }\n    \n  }\n}\n\n</script>\n\n<style >\n.espacio {\n  cursor: pointer;\n}\n\n.espacio:hover {\n  color: #155724;\n  background-color: #d4edda;\n  border-color: #c3e6cb;\n}\n\n.espacio:active{\n  background-color: #20c997;\n}\n\n/* .table-scroll {\n  position: relative;\n  height: 400px;\n  overflow: auto;\n} */\n\n.div-scroll {\n  position: relative;\n  overflow: auto;\n  max-height: 400px;\n}\n\n.vs__dropdown-toggle {\n  padding: 0 0 1px!important;\n}\n</style>\n"]}]}